<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Ranking in a two-sided matching platform (Part 1) | Evgeny Ivanov</title><link href=https://e10v.me/favicon.svg rel=icon type=image/svg+xml><link href=https://e10v.me/favicon.png rel=apple-touch-icon><link href=https://e10v.me/favicon.ico rel=icon sizes=32x32><meta content="In a two-sided matching platform, both sides have to choose each other for a deal to happen, and that makes the ranking problem harder and kind of unique." name=description><meta content="Evgeny Ivanov" name=author><meta content="Ranking in a two-sided matching platform (Part 1) | Evgeny Ivanov" property=og:title><meta content="In a two-sided matching platform, both sides have to choose each other for a deal to happen, and that makes the ranking problem harder and kind of unique." property=og:description><meta content="Evgeny Ivanov" property=og:site_name><meta content=https://e10v.me/ranking-two-sided-matching-platform-part-1/ property=og:url><meta content=article property=og:type><meta content="Evgeny Ivanov" property=article:author><meta content="learning to rank" property=article:tag><meta content="uplift modelling" property=article:tag><meta content="matching market" property=article:tag><meta content=marketplace property=article:tag><meta content=https://e10v.me/ranking-two-sided-matching-platform-part-1/matching_process.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=https://e10v.me/ranking-two-sided-matching-platform-part-1/matching_process.png name=twitter:image><meta content="Ranking in a two-sided matching platform (Part 1) | Evgeny Ivanov" name=twitter:title><meta content="In a two-sided matching platform, both sides have to choose each other for a deal to happen, and that makes the ranking problem harder and kind of unique." name=twitter:description><meta content=@e10v_me name=twitter:site><meta content=@e10v_me name=twitter:creator><link href=https://e10v.me/ranking-two-sided-matching-platform-part-1/ rel=canonical><link title="Evgeny Ivanov" href=https://e10v.me/atom.xml rel=alternate type=application/atom+xml><link crossorigin href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css integrity=sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT rel=stylesheet><link href=https://e10v.me/css/style.css rel=stylesheet><link href=/css/syntax-theme-dark.css id=syntax-theme rel=stylesheet><script src=https://e10v.me/js/color-modes.js></script><body><div class="container mb-5"><header><nav class="navbar navbar-expand-sm"><button aria-label="Toggle navigation" aria-controls=navbarSupportedContent aria-expanded=false class=navbar-toggler data-bs-target=#navbarSupportedContent data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto"><li class=nav-item><a class="nav-link ps-0" href=https://e10v.me>Posts</a><li class=nav-item><a class=nav-link href=https://e10v.me/highlights>Highlights</a><li class=nav-item><a class=nav-link href=https://e10v.me/tags>Tags</a><li class=nav-item><a class=nav-link href=https://e10v.me/about>About</a></ul><hr class="d-sm-none my-2"><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://github.com/e10v target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>GitHub</title><use href=https://e10v.me/icons.svg#github></use></svg> <span class="d-sm-none ms-1">GitHub</span> </a><li class=nav-item><a class=nav-link href=https://www.linkedin.com/in/evgenyivanov target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>LinkedIn</title><use href=https://e10v.me/icons.svg#linkedin></use></svg> <span class="d-sm-none ms-1">LinkedIn</span> </a><li class=nav-item><a class=nav-link href=https://x.com/e10v_me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>X (Twitter)</title><use href=https://e10v.me/icons.svg#twitter-x></use></svg> <span class="d-sm-none ms-1">X (Twitter)</span> </a><li class=nav-item><a class=nav-link href=https://bsky.app/profile/e10v.me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>Bluesky</title><use href=https://e10v.me/icons.svg#bluesky></use></svg> <span class="d-sm-none ms-1">Bluesky</span> </a><li class=nav-item><a class=nav-link href=https://t.me/e10v_me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>Telegram</title><use href=https://e10v.me/icons.svg#telegram></use></svg> <span class="d-sm-none ms-1">Telegram</span> </a><li class="nav-item pt-2 pb-1"><div class="vr d-none d-sm-flex h-100 mx-2"></div> <hr class="d-sm-none my-2"><li class="nav-item dropdown"><button aria-label="Toggle theme (auto)" class="nav-link dropdown-toggle pe-0" aria-expanded=false data-bs-display=static data-bs-toggle=dropdown id=bd-theme type=button><svg class="bi theme-icon-active" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#circle-half></use></svg> <span class="d-sm-none ms-1" id=bd-theme-text>Theme</span></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button class="dropdown-item d-flex align-items-center" aria-pressed=true data-bs-theme-value=auto type=button><svg class="bi me-2 theme-icon" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#circle-half></use></svg> Auto <svg class="bi ms-auto d-none" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#check2></use></svg></button><li><button class="dropdown-item d-flex align-items-center" aria-pressed=false data-bs-theme-value=light type=button><svg class="bi me-2 theme-icon" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#sun-fill></use></svg> Light <svg class="bi ms-auto d-none" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#check2></use></svg></button><li><button class="dropdown-item d-flex align-items-center" aria-pressed=false data-bs-theme-value=dark type=button><svg class="bi me-2 theme-icon" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#moon-stars-fill></use></svg> Dark <svg class="bi ms-auto d-none" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><use href=https://e10v.me/icons.svg#check2></use></svg></button></ul></ul></div></nav></header><main><article><h1 class=mb-4>Ranking in a two-sided matching platform (Part 1)</h1><p class="mb-3 tag"><small class="text-secondary me-1">Aug 15, 2023</small> <small><a class="bg-body-secondary py-1 px-2 rounded-2" href=https://e10v.me/tags/learning-to-rank/>learning to rank</a></small> <small><a class="bg-body-secondary py-1 px-2 rounded-2" href=https://e10v.me/tags/uplift-modelling/>uplift modelling</a></small> <small><a class="bg-body-secondary py-1 px-2 rounded-2" href=https://e10v.me/tags/matching-market/>matching market</a></small> <small><a class="bg-body-secondary py-1 px-2 rounded-2" href=https://e10v.me/tags/marketplace/>marketplace</a></small><h2 class=h2 id=overview>Overview <a aria-label="Anchor link for: overview" class=anchor-link href=#overview>#</a></h2><p>Profi is a two-sided matching platform where customers can find tutors, beauty masters, plumbers, and other professionals, and professionals can find customers. It's a horizontal marketplace with over 900 types of services provided by professionals.<p>The quality of search and ranking is important for the matching process there. In a two-sided matching platform, both sides have to choose each other for a deal to happen, and that makes the ranking problem harder and kind of unique.<p>In two blog posts, I'll explore the ranking problem and explain the solution that significantly increased the number of deals in the marketplace.<p>In this first post, I will cover:<ul><li>The concept of matching markets and their distinctions from other markets.<li>The mechanics of Profi's matching process.<li>Business objectives.<li>The three versions of the problem formulation, with insights into why certain approach succeeded while others did not.</ul><p>In the <a href=https://e10v.me/ranking-two-sided-matching-platform-part-2/>second post</a>, I will cover the details of the successful solution that was implemented in production.<h2 class=h2 id=matching-markets>Matching markets <a aria-label="Anchor link for: matching-markets" class=anchor-link href=#matching-markets>#</a></h2><p>When a customer places an order on Amazon, the seller doesn't get to choose whether or not to sell to this customer. And this is an example of a commodity market.<p>In matching markets, you can't just choose and get what you want—you also have to be chosen. Examples of matching markets and platforms:<ul><li>Labor market.<li>Airbnb before introducing the instant booking feature.<li>Dating platforms, like Tinder and Bumble.<li>Platforms for freelancers, like Upwork and Fiverr.</ul><p>While in commodity markets prices do most of the work and balance supply and demand, in matching markets, price is not the most important factor. Market design, search, and ranking algorithms play a crucial role there.<p>To learn more about matching markets read <a href=https://www.amazon.com/Who-Gets-What-Economics-Matchmaking-ebook/dp/B00LZ7GQJQ/ rel=noopener target=_blank>Who Gets What—and Why</a> by Alvin Roth, a Nobel Prize laureate in Economics.<h2 class=h2 id=matching-process>Matching process <a aria-label="Anchor link for: matching-process" class=anchor-link href=#matching-process>#</a></h2><p>The process of how customers and professional can find each other on Profi:<ul><li>Customers place orders and describe the details of the work.<li>Professionals search, choose orders, and send proposals to the customers.<li>The customers review the proposals and choose the professionals, or don't choose anyone.<li>If a professional sends a proposal to a customer, and the customer choses the professional then this is a deal.</ul><figure class="figure text-center mx-auto d-block mb-4"><img alt="Professionals choose orders and send proposals" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/professionals_choose_customers.svg width=440px><figcaption class=figure-caption><p>Professionals choose orders and send proposals</p></figcaption></figure><figure class="figure text-center mx-auto d-block mb-4"><img alt="Customers review proposals and choose professionals" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/customers_choose_professionals.svg width=440px><figcaption class=figure-caption><p>Customers review proposals and choose professionals</p></figcaption></figure><h2 class=h2 id=business-objective>Business objective <a aria-label="Anchor link for: business-objective" class=anchor-link href=#business-objective>#</a></h2><p>The order feed in the app for professionals is the source of 56% of proposals. Orders in the feed are selected based on a professional's preferences and previous activity. Originally, orders were sorted in reverse chronological order.<p>While order "freshness" is important for professionals, it's not the only factor of choice. The hypothesis was that we could improve the matching process by implementing a new order ranking algorithm.<p>The objective was to increase the number of deals, which is one of the two most important metrics in the company.<h2 class=h2 id=problem-formulation>Problem formulation <a aria-label="Anchor link for: problem-formulation" class=anchor-link href=#problem-formulation>#</a></h2><h3 class=h4 id=probability-of-a-proposal>Probability of a proposal <a aria-label="Anchor link for: probability-of-a-proposal" class=anchor-link href=#probability-of-a-proposal>#</a></h3><p>The first idea was to sort orders by the probability of a proposal. The intuition was the following:<ul><li>Sorting by the probability of a proposal would help professionals to find more relevant orders.<li>Professionals would send more proposals.<li>Customers would receive more proposals and have more choice.<li>A wider choice of proposals would increase the probability of finding the right professional.<li>The number of deals would increase.</ul><figure class="figure text-center mx-auto d-block mb-4"><img alt="Predicting the probability of a proposal" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/probability_of_proposal.svg width=440px><figcaption class=figure-caption><p>Predicting the probability of a proposal</p></figcaption></figure><p>We trained a machine learning model with the following target and conducted an experiment:<figure class="figure text-center mx-auto d-block mb-4"><table><thead><tr><th style=text-align:left>Proposal<th style=text-align:left>Deal<th style=text-align:right>Target<tbody><tr><td style=text-align:left>Yes<td style=text-align:left>Yes<td style=text-align:right>1<tr><td style=text-align:left>Yes<td style=text-align:left>No<td style=text-align:right>1<tr><td style=text-align:left>No<td style=text-align:left>No<td style=text-align:right>0</table><figcaption class=figure-caption>Predicting the probability of a proposal</figcaption></figure><p>The experiment resulted in the following:<ul><li>The number of proposals had indeed increased.<li>But the number of deals had not increased.</ul><p>The interpretation was that extra proposals were sent to customers who already had enough proposals to choose from.<p>Increasing the number of proposals without increasing the number of deals is not good both for professionals and for customers:<ul><li>Professionals make an extra effort to write and send proposals, but they don't get more customers.<li>Customers are distracted by additional proposals while they already have enough to choose from.</ul><h3 class=h4 id=probability-of-a-deal>Probability of a deal <a aria-label="Anchor link for: probability-of-a-deal" class=anchor-link href=#probability-of-a-deal>#</a></h3><p>The next intuitive choice was to sort orders by the probability of a deal, and to train a model with the following target:<figure class="figure text-center mx-auto d-block mb-4"><table><thead><tr><th style=text-align:left>Proposal<th style=text-align:left>Deal<th style=text-align:right>Target<tbody><tr><td style=text-align:left>Yes<td style=text-align:left>Yes<td style=text-align:right>1<tr><td style=text-align:left>Yes<td style=text-align:left>No<td style=text-align:right>0<tr><td style=text-align:left>No<td style=text-align:left>No<td style=text-align:right>0</table><figcaption class=figure-caption>Predicting the probability of a deal</figcaption></figure><p>To be precise, for a pair of a professional and a customer <em>(P, C)</em>, a model should've predicted the probability that:<ul><li>The professional <em>P</em> would send a proposal to the customer <em>C</em>.<li>And the customer <em>C</em> would choose the professional <em>P</em> among others.</ul><figure class="figure text-center mx-auto d-block mb-4"><img alt="Predicting the probability of a deal" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/probability_of_deal.svg width=440px><figcaption class=figure-caption><p>Predicting the probability of a deal</p></figcaption></figure><p>But, if you think carefully, you can see that this is not the right problem formulation for the case:<ul><li>First, imagine that the first professional on the picture above has sent a proposal to the first customer, and that this customer has chosen this professional.<li>Then the second professional wouldn't get a deal with the first customer. Does that mean that the second professional shouldn't have sent the proposal?<li>Now, imagine that the first professional hasn't sent a proposal. Then the proposal from the second professional could be valuable.</ul><figure class="figure text-center mx-auto d-block mb-4"><img alt="A customer can choose another professional" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/customer_can_choose_another_professional.svg width=440px><figcaption class=figure-caption><p>A customer can choose another professional</p></figcaption></figure><p>We decided not to move forward with this formulation of the problem as it doesn't correctly reflect the matching process.<h3 class=h4 id=uplift-in-the-probability-of-a-deal>Uplift in the probability of a deal <a aria-label="Anchor link for: uplift-in-the-probability-of-a-deal" class=anchor-link href=#uplift-in-the-probability-of-a-deal>#</a></h3><p>The last idea was to estimate how showing an order to a professional would change the probability of a deal in that order, no matter with which professional. The model should calculate a difference in the probability of a deal in an order between two parallel universes:<ul><li>The one where we show the order to the professional.<li>The one where we don't show the order to the professional.</ul><p>Models that compare parallel universes are called uplift models.<figure class="figure text-center mx-auto d-block mb-4"><img alt="Uplift in the probability of a deal" class="figure-img img-fluid mb-0" src=https://e10v.me/ranking-two-sided-matching-platform-part-1/uplift_in_probability_of_deal.svg width=440px><figcaption class=figure-caption><p>Uplift in the probability of a deal</p></figcaption></figure><p>Ranking orders by the uplift in the probability of a deal showed the following results in the experiment (measured with proxy metrics):<ul><li>The number of deals coming from the order feed had increased by 10%.<li>The total number of deals had increased by 5%.</ul><p>It was a great result in itself. But it also opened a door for further improvements, not only in ranking of orders. For example, finding more relevant orders and adding them to the order feed automatically increases the number of deals.<p>I will get into some details of the model in the <a href=https://e10v.me/ranking-two-sided-matching-platform-part-2/>next post</a>. Stay tuned.<h2 class=h2 id=p-s-type-iii-error>P.S. Type III error <a aria-label="Anchor link for: p-s-type-iii-error" class=anchor-link href=#p-s-type-iii-error>#</a></h2><p>This case reminded me of a notion of a type III error. Before I explain what it means, let me give you examples of type I and type II errors in the context of the ranking of orders:<ul><li>Imagine we show an order to a professional and expect that the professional to send a proposal. But the professional doesn't send a proposal. That's a type I error.<li>Now imagine we don't show an order to a professional because we don't expect the professional to send a proposal. But if we showed it, the professional would send a proposal. That's a type II error.</ul><p>Well, whether the professional would send a proposal or not, is not the right question in the first place, at least not the final one. And that's a <a href=https://en.wikipedia.org/wiki/Type_III_error rel=noopener target=_blank>type III error</a>.<p>Also, check out Cassie Kozyrkov's excellent explanation: <a href=https://youtu.be/R51nueuAyIY rel=noopener target=_blank>https://youtu.be/R51nueuAyIY</a>.<p class=my-4>© Evgeny Ivanov 2023</article></main><footer><p class=my-4>Follow me on:<a class="link-body-emphasis ms-2" href=https://www.linkedin.com/in/evgenyivanov target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>LinkedIn</title><use href=https://e10v.me/icons.svg#linkedin></use></svg> <span class=d-sm-none>LinkedIn</span> </a><a class="link-body-emphasis ms-2" href=https://x.com/e10v_me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>X (Twitter)</title><use href=https://e10v.me/icons.svg#twitter-x></use></svg> <span class=d-sm-none>X (Twitter)</span> </a><a class="link-body-emphasis ms-2" href=https://bsky.app/profile/e10v.me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>Bluesky</title><use href=https://e10v.me/icons.svg#bluesky></use></svg> <span class=d-sm-none>Bluesky</span> </a><a class="link-body-emphasis ms-2" href=https://t.me/e10v_me target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>Telegram</title><use href=https://e10v.me/icons.svg#telegram></use></svg> <span class=d-sm-none>Telegram</span> </a><a class="link-body-emphasis ms-2" href=https://e10v.me/atom.xml target=_blank> <svg viewbox="0 0 16 16" class=bi fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><title>Atom</title><use href=https://e10v.me/icons.svg#rss-fill></use></svg> <span class=d-sm-none>Atom</span> </a></footer><div id=comments><script async crossorigin data-category=Announcements data-category-id=DIC_kwDOKD9-Dc4CmKHr data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=title data-reactions-enabled=1 data-repo=e10v/e10v.github.io data-repo-id=R_kgDOKD9-DQ data-strict=1 data-theme=preferred_color_scheme src=https://giscus.app/client.js></script></div></div><script crossorigin integrity=sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js></script><script>!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
      posthog.init(
        'phc_JnHY3mAJstOfhK5yVoQJTvuVXJJk9AmGGzzCUOTMB2D',
        {
          api_host:'https://app.posthog.com',
          persistence: 'memory',
        },
      )</script>